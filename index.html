<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Validator Info Lookup</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; }
    .result { margin-top: 20px; background: #f9f9f9; padding: 15px; border-radius: 10px; white-space: pre-wrap; }
    h1 { font-size: 22px; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>🔎 Validator Info Checker (Sepolia)</h1>

  <input type="text" id="validatorAddress" placeholder="Paste validator address here…" />
  <button onclick="lookup()">Check Info</button>

  <div class="result" id="result">🟡 Waiting for input…</div>

  <script>
    const provider = new ethers.providers.StaticJsonRpcProvider(
      'https://ethereum-sepolia.publicnode.com',
      { name: 'sepolia', chainId: 11155111 }
    );

    const validatorContract = new ethers.Contract(
      '0xeE6d4e937f0493Fb461F28A75Cf591f1dBa8704E',
      [{
        "inputs": [{ "internalType": "address", "name": "validator", "type": "address" }],
        "name": "getInfo",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" },
          { "internalType": "address", "name": "", "type": "address" },
          { "internalType": "address", "name": "", "type": "address" },
          { "internalType": "uint8", "name": "", "type": "uint8" }
        ],
        "stateMutability": "view",
        "type": "function"
      }],
      provider
    );

    const registryContract = new ethers.Contract(
      '0xF739D03e98e23A7B65940848aBA8921fF3bAc4b2',
      [{
        "name": "getRollup",
        "inputs": [],
        "outputs": [{ "type": "address" }],
        "stateMutability": "view",
        "type": "function"
      }],
      provider
    );

    const rollupContract = new ethers.Contract(
      '0xbd6112ffb782805bed87b3748776eeb5c20b7388',
      [
        {
          "name": "getEpochDuration",
          "inputs": [],
          "outputs": [{ "type": "uint32" }],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "name": "getBurnAddress",
          "inputs": [],
          "outputs": [{ "type": "address" }],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "name": "getVersion",
          "inputs": [],
          "outputs": [{ "type": "uint256" }],
          "stateMutability": "view",
          "type": "function"
        }
      ],
      provider
    );

    async function lookup() {
      const address = document.getElementById('validatorAddress').value.trim();
      const resultDiv = document.getElementById('result');

      if (!ethers.utils.isAddress(address)) {
        resultDiv.textContent = '❌ Invalid address';
        return;
      }

      resultDiv.textContent = '⏳ Fetching validator info…';

      try {
        const [info, rollupAddr, epoch, burnAddr, version] = await Promise.all([
          validatorContract.getInfo(address),
          registryContract.getRollup(),
          rollupContract.getEpochDuration(),
          rollupContract.getBurnAddress(),
          rollupContract.getVersion()
        ]);

        const stakedStr = info[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        const status = parseInt(info[3]);
        const statusText =
          status === 3 ? 'The validator has completed their exit delay and can be exited from the validator set'
          : status === 2 ? 'Pending exit'
          : status === 1 ? 'Active'
          : 'Unknown';

        resultDiv.innerHTML = `
🔷 VALIDATOR DETAILS 🔷

🔴 Status: ${statusText}

📋 BASIC INFO
🔑 Address: ${address}
💰 Staked Amount: ${stakedStr}
👤 Proposer Address: ${info[1]}
💼 Withdrawer Address: ${info[2]}

🌐 NETWORK INFO 🌐
🧮 Canonical Rollup (from Registry): ${rollupAddr}
⏱️ Epoch Duration: ${epoch} seconds
🔥 Burn Address: ${burnAddr}
🔢 Version: ${version}

⚠️ ATTENTION ⚠️
Aztec chain has been upgraded on 22 May 2025
It seems some validators should be re-added to the set (waiting for confirmation from team)

🔔 Follow us on Twitter to stay tuned for future news about Aztec and our bot:
🔗 <a href="https://x.com/Ember_Stake" target="_blank">https://x.com/Ember_Stake</a>
        `;
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = `<span style="color:red;">❌ Error:</span> ${err.message}`;
      }
    }
  </script>
</body>
</html>
