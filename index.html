<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Validator Info Lookup</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; }
    .result { margin-top: 20px; background: #f1f1f1; padding: 15px; border-radius: 10px; white-space: pre-wrap; }
    h1 { font-size: 24px; margin-bottom: 15px; }
    a { color: blue; }
  </style>
</head>
<body>
  <h1>🔎 Validator Info Checker (Sepolia)</h1>

  <input type="text" id="validatorAddress" placeholder="Paste validator address here…" />
  <button onclick="lookup()">Check Info</button>

  <div class="result" id="result">🟡 Waiting for input…</div>

  <script>
    const provider = new ethers.providers.StaticJsonRpcProvider(
      'https://ethereum-sepolia.publicnode.com',
      { name: 'sepolia', chainId: 11155111 }
    );

    const contractAddr = '0xeE6d4e937f0493Fb461F28A75Cf591f1dBa8704E';

    const abi = [
      {
        name: "getInfo",
        inputs: [{ name: "validator", type: "address" }],
        outputs: [
          { name: "stakedAmount", type: "uint256" },
          { name: "proposer", type: "address" },
          { name: "withdrawer", type: "address" },
          { name: "status", type: "uint8" }
        ],
        stateMutability: "view", type: "function"
      },
      {
        name: "getAttesters",
        inputs: [],
        outputs: [{ name: "", type: "address[]" }],
        stateMutability: "view", type: "function"
      },
      {
        name: "getVersion",
        inputs: [],
        outputs: [{ name: "", type: "uint256" }],
        stateMutability: "view", type: "function"
      },
      {
        name: "getBurnAddress",
        inputs: [],
        outputs: [{ name: "", type: "address" }],
        stateMutability: "view", type: "function"
      },
      {
        name: "getEpochDuration",
        inputs: [],
        outputs: [{ name: "", type: "uint32" }],
        stateMutability: "view", type: "function"
      },
      {
        name: "getExitInfo",
        inputs: [{ name: "", type: "address" }],
        outputs: [
          { name: "exitTimestamp", type: "uint256" },
          { name: "withdrawTarget", type: "address" }
        ],
        stateMutability: "view", type: "function"
      }
    ];

    const contract = new ethers.Contract(contractAddr, abi, provider);

    async function lookup() {
      const addr = document.getElementById("validatorAddress").value.trim();
      const resultDiv = document.getElementById("result");

      if (!ethers.utils.isAddress(addr)) {
        resultDiv.innerText = "❌ Invalid address";
        return;
      }

      resultDiv.innerText = "⏳ Fetching validator info…";

      try {
        const [info, attesters, version, burn, epoch] = await Promise.all([
          contract.getInfo(addr),
          contract.getAttesters(),
          contract.getVersion(),
          contract.getBurnAddress(),
          contract.getEpochDuration()
        ]);

        let exitTimestamp = "(unknown)";
        try {
          const exitInfo = await contract.getExitInfo(addr);
          exitTimestamp = new Date(exitInfo.exitTimestamp * 1000).toUTCString();
        } catch (e) {
          // some validators may not have exitInfo
        }

        const isRegistered = attesters.map(a => a.toLowerCase()).includes(addr.toLowerCase());
        const statusDesc = ["Unknown", "Active", "Pending Exit", "Exited"][info.status] || "Unknown";

        resultDiv.innerHTML = `
🔷 VALIDATOR DETAILS 🔷

📋 BASIC INFO
🔑 Address: ${addr}
💰 Staked Amount: ${ethers.utils.formatEther(info.stakedAmount)} ETH
👤 Proposer Address: ${info.proposer}
💼 Withdrawer Address: ${info.withdrawer}
🔢 Status: ${statusDesc}
🧾 Registered: ${isRegistered ? "✅ Yes" : "❌ No"}
🕒 Exit Timestamp: ${exitTimestamp}

🌐 NETWORK INFO 🌐
🧮 Total Validators: ${attesters.length}
📦 Contract Version: ${version}
⏱ Epoch Duration: ${epoch} seconds
🔥 Burn Address: ${burn}

🔔 Follow us on Twitter:
🔗 <a href="https://x.com/Ember_Stake" target="_blank">https://x.com/Ember_Stake</a>
        `;
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = `<span style="color:red;">❌ Error:</span> ${err.message}`;
      }
    }
  </script>
</body>
</html>
