<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Validator Checker (Sepolia)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; }
    .result { margin-top: 20px; background: #f7f7f7; padding: 15px; border-radius: 8px; }
    h1 { font-size: 22px; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>🔍 Validator Info Checker (Sepolia)</h1>

  <input type="text" id="validatorAddress" placeholder="Paste validator address here..." />
  <button onclick="checkValidator()">Check Validator</button>

  <div class="result" id="result">🟡 Waiting for input...</div>

  <script>
    const contractAddress = '0xeE6d4e937f0493Fb461F28A75Cf591f1dBa8704E';

    // Gunakan StaticJsonRpcProvider agar tidak perlu deteksi network otomatis
    const provider = new ethers.providers.StaticJsonRpcProvider('http://83.171.249.10:8545/', {
      name: 'sepolia',
      chainId: 11155111
    });

    // ABI minimal dan valid (yang pasti tidak error)
    const validatorAbi = [
      {
        "inputs": [],
        "name": "getAttesters",
        "outputs": [{ "internalType": "address[]", "name": "", "type": "address[]" }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getBurnAddress",
        "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getEpochDuration",
        "outputs": [{ "internalType": "uint32", "name": "", "type": "uint32" }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    const contract = new ethers.Contract(contractAddress, validatorAbi, provider);

    async function checkValidator() {
      const address = document.getElementById('validatorAddress').value.trim().toLowerCase();
      const resultDiv = document.getElementById('result');

      resultDiv.innerHTML = '⏳ Checking...';

      try {
        const attesters = await contract.getAttesters();
        const isRegistered = attesters.map(a => a.toLowerCase()).includes(address);

        const burnAddr = await contract.getBurnAddress();
        const owner = await contract.owner();
        const epoch = await contract.getEpochDuration();

        resultDiv.innerHTML = `
          <strong>📋 VALIDATOR INFO</strong><br>
          🔑 Address: ${address}<br>
          🟢 Registered Validator: ${isRegistered ? '✅ Yes' : '❌ No'}<br><br>
          
          <strong>🌐 CONTRACT INFO</strong><br>
          🔥 Burn Address: ${burnAddr}<br>
          👑 Owner: ${owner}<br>
          ⏳ Epoch Duration: ${epoch}
        `;
      } catch (error) {
        resultDiv.innerHTML = `<span style="color:red;">❌ Error:</span> ${error.message}`;
      }
    }
  </script>
</body>
</html>
